<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyA7Ui4SXydisrIUpeX32vpqcIDQCsqOLXo",
  authDomain: "saayadonat.firebaseapp.com",
  databaseURL: "https://saayadonat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "saayadonat",
  storageBucket: "saayadonat.firebasestorage.app",
  messagingSenderId: "191838417140",
  appId: "1:191838417140:web:b698670357abe7dff2eea1"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var products = [];
var orders = [];
var chart;

function login(){
  if(pass.value === "admin123"){
    document.getElementById('panel').classList.remove('hidden');
  }
}

function addProduct(){
  products.push({
    name:pName.value,
    price:+pPrice.value,
    stock:+pStock.value
  });
  db.ref("products").set(products);
}

function updateStock(i,val){
  products[i].stock += val;
  if(products[i].stock < 0) products[i].stock = 0;
  db.ref("products").set(products);
}

db.ref("products").on("value", function(snapshot){
  products = snapshot.val() || [];
  render();
});

db.ref("orders").on("value", function(snapshot){
  orders = [];
  snapshot.forEach(function(child){
    orders.push(child.val());
  });
  renderOrders();
  renderChart();
});

function render(){
  var html='';
  products.forEach(function(p,i){
    html += `
      <div>
      <b>${p.name}</b>
      <span class="badge">Stok ${p.stock}</span><br>
      Rp ${p.price}<br>
      <button onclick="updateStock(${i},1)">+ Stok</button>
      <button onclick="updateStock(${i},-1)">- Stok</button>
      <hr></div>`;
  });
  document.getElementById("productList").innerHTML = html;
}

function renderOrders(){
  var html='';
  var today=0;
  var todayStr=new Date().toLocaleDateString();

  orders.forEach(function(o){
    if(o.date===todayStr) today+=o.total;
    html+=`<tr>
      <td>${o.date}</td>
      <td>${o.name}</td>
      <td>${o.product}</td>
      <td>${o.qty}</td>
      <td>${o.total}</td>
    </tr>`;
  });

  document.getElementById("orderTable").innerHTML = html;
  document.getElementById("todayIncome").innerText =
    "Omzet Hari Ini: Rp " + today;
}

function renderChart(){
  var data={};
  orders.forEach(function(o){
    data[o.date]=(data[o.date]||0)+o.total;
  });

  var labels=Object.keys(data);
  var values=Object.values(data);

  if(chart) chart.destroy();

  chart=new Chart(document.getElementById("chart"),{
    type:"bar",
    data:{labels:labels,datasets:[{label:"Omzet",data:values}]}
  });
}
</script>      <b>${p.name}</b>
      <span class="badge">Stok ${p.stock}</span><br>
      Rp ${p.price}<br>
      <button onclick="updateStock(${i},1)">+ Stok</button>
      <button onclick="updateStock(${i},-1)">- Stok</button>
      <hr></div>`;
  });
  document.getElementById("productList").innerHTML = html;
}

function renderOrders(){
  var html='';
  var today=0;
  var todayStr=new Date().toLocaleDateString();

  orders.forEach(function(o){
    if(o.date===todayStr) today+=o.total;
    html+=`<tr>
      <td>${o.date}</td>
      <td>${o.name}</td>
      <td>${o.product}</td>
      <td>${o.qty}</td>
      <td>${o.total}</td>
    </tr>`;
  });

  document.getElementById("orderTable").innerHTML = html;
  document.getElementById("todayIncome").innerText =
    "Omzet Hari Ini: Rp " + today;
}

function renderChart(){
  var data={};
  orders.forEach(function(o){
    data[o.date]=(data[o.date]||0)+o.total;
  });

  var labels=Object.keys(data);
  var values=Object.values(data);

  if(chart) chart.destroy();

  chart=new Chart(document.getElementById("chart"),{
    type:"bar",
    data:{labels:labels,datasets:[{label:"Omzet",data:values}]}
  });
}
</script>      <span class="badge">Stok ${p.stock}</span><br>
      Rp ${p.price}<br>
      <button onclick="updateStock(${i},1)">+ Stok</button>
      <button onclick="updateStock(${i},-1)">- Stok</button>
      <hr>
    </div>`;
  });
  document.getElementById('productList').innerHTML=html;
}

function renderOrders(){
  let html='';
  let today=0;
  let todayStr=new Date().toLocaleDateString();

  orders.forEach(o=>{
    if(o.date===todayStr) today+=o.total;
    html+=`
    <tr>
      <td>${o.date}</td>
      <td>${o.name}</td>
      <td>${o.product}</td>
      <td>${o.qty}</td>
      <td>${o.total}</td>
    </tr>`;
  });

  document.getElementById('orderTable').innerHTML=html;
  document.getElementById('todayIncome').innerText='Omzet Hari Ini: Rp '+today;
}

function renderChart(){
  let data={};
  orders.forEach(o=>{
    data[o.date]=(data[o.date]||0)+o.total;
  });

  let labels=Object.keys(data);
  let values=Object.values(data);

  if(chart) chart.destroy();

  chart=new Chart(document.getElementById('chart'),{
    type:'bar',
    data:{labels:labels,datasets:[{label:'Omzet',data:values}]}
  });
}

</script>document.getElementById('todayIncome').innerText='Omzet Hari Ini: Rp '+today;
}

function renderChart(){
let data={};
orders.forEach(o=>{data[o.date]=(data[o.date]||0)+o.total});
let labels=Object.keys(data);
let values=Object.values(data);
if(chart)chart.destroy();
chart=new Chart(document.getElementById('chart'),{
type:'bar',
data:{labels:labels,datasets:[{label:'Omzet',data:values}]}
});
}
</script>
</body>
</html>
