<script>
var firebaseConfig = {
  apiKey: "AIzaSyA7Ui4SXydisrIUpeX32vpqcIDQCsqOLXo",
  authDomain: "saayadonat.firebaseapp.com",
  databaseURL: "https://saayadonat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "saayadonat",
  storageBucket: "saayadonat.firebasestorage.app",
  messagingSenderId: "191838417140",
  appId: "1:191838417140:web:b698670357abe7dff2eea1"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var products = [];
var ADMIN_PASSWORD = "admin123"; // ganti kalau mau

document.addEventListener("DOMContentLoaded", function(){

  const loginPage = document.getElementById("loginPage");
  const adminPanel = document.getElementById("adminPanel");
  const adminPass = document.getElementById("adminPass");

  // ==========================
  // CEK LOGIN (PROTEKSI)
  // ==========================
  if(localStorage.getItem("adminLogin") === "true"){
      showAdmin();
  } else {
      showLogin();
  }

  window.login = function(){
      if(adminPass.value === ADMIN_PASSWORD){
          localStorage.setItem("adminLogin","true");
          showAdmin();
      } else {
          alert("Password salah!");
      }
  }

  window.logout = function(){
      localStorage.removeItem("adminLogin");
      showLogin();
  }

  function showAdmin(){
      loginPage.style.display = "none";
      adminPanel.style.display = "block";
  }

  function showLogin(){
      loginPage.style.display = "block";
      adminPanel.style.display = "none";
  }

});

// ==========================
// LOAD PRODUK
// ==========================
db.ref("products").on("value", function(snapshot){
  products = snapshot.val() || [];
  renderProducts();
});

// ==========================
// LOAD ORDER
// ==========================
db.ref("orders").on("value", function(snapshot){
  var html="";
  snapshot.forEach(function(child){
    var o = child.val();
    html+=`
    <tr>
      <td>${o.date || "-"}</td>
      <td>${o.name || "-"}</td>
      <td>${o.product || "-"}</td>
      <td>${o.qty || 1}</td>
      <td>Rp ${o.total || 0}</td>
    </tr>`;
  });
  document.getElementById("orders").innerHTML = html;
});

// ==========================
// TAMBAH PRODUK
// ==========================
function addProduct(){
  products.push({
    name:pName.value,
    price:+pPrice.value,
    stock:+pStock.value
  });
  db.ref("products").set(products);
  pName.value="";
  pPrice.value="";
  pStock.value="";
}

// ==========================
// RENDER PRODUK
// ==========================
function renderProducts(){
  var html="";
  products.forEach(function(p,i){
    html+=`
      <div class="card">
      <b>${p.name}</b><br>
      Harga: Rp ${p.price}<br>
      Stok: ${p.stock}<br><br>

      <button onclick="updateStock(${i},1)">+ Stok</button>
      <button onclick="updateStock(${i},-1)">- Stok</button>
      <button onclick="deleteProduct(${i})" style="background:red">Hapus</button>
      </div>`;
  });
  document.getElementById("products").innerHTML = html;
}

function updateStock(index, change){
  products[index].stock += change;
  if(products[index].stock < 0){
    products[index].stock = 0;
  }
  db.ref("products").set(products);
}

function deleteProduct(index){
  if(confirm("Yakin hapus produk?")){
    products.splice(index,1);
    db.ref("products").set(products);
  }
}
</script>
