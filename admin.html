<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin SaAya Donat</title>

<style>
body{font-family:Arial;background:#fff0f6;margin:0;padding:15px}
.card{background:#fff;padding:15px;margin-bottom:15px;border-radius:12px}
button{padding:6px 10px;border:none;background:#ff6fb5;color:#fff;border-radius:6px;cursor:pointer}
input{padding:6px;width:100%;box-sizing:border-box;margin-bottom:8px}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{padding:8px;border:1px solid #ddd;text-align:center}
th{background:#ff6fb5;color:#fff}
#adminPanel{display:none}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage">
<h2>üîê Login Admin</h2>
<input type="password" id="adminPass" placeholder="Masukkan Password">
<button onclick="login()">Login</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
<h2>üì¶ Admin Panel</h2>
<button onclick="logout()" style="background:#333;margin-bottom:10px">Logout</button> <button onclick="resetProducts()" style="background:orange;margin-bottom:5px">
Reset Produk
</button>

<button onclick="resetOrders()" style="background:#e67e22;margin-bottom:5px">
Reset Orders
</button>

<button onclick="resetAll()" style="background:red;margin-bottom:10px">
Reset Semua Data
</button>

<div class="card">
<input id="pName" placeholder="Nama Produk">
<input id="pPrice" type="number" placeholder="Harga">
<input id="pStock" type="number" placeholder="Stok">
<button onclick="addProduct()">Tambah Produk</button>
</div>

<h3>Daftar Produk</h3>
<div id="products"></div>

<h3>üìã Rincian Order Masuk</h3>
<table>
<thead>
<tr>
<th>Tanggal</th>
<th>Nama</th>
<th>Produk</th>
<th>Qty</th>
<th>Total</th>
</tr>
</thead>
<tbody id="orders"></tbody>
</table>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyA7Ui4SXydisrIUpeX32vpqcIDQCsqOLXo",
  authDomain: "saayadonat.firebaseapp.com",
  databaseURL: "https://saayadonat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "saayadonat",
  storageBucket: "saayadonat.firebasestorage.app",
  messagingSenderId: "191838417140",
  appId: "1:191838417140:web:b698670357abe7dff2eea1"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var ADMIN_PASSWORD = "admin123";
var products = [];

// ================= LOGIN PROTECTION =================
if(localStorage.getItem("adminLogin") === "true"){
  document.getElementById("loginPage").style.display="none";
  document.getElementById("adminPanel").style.display="block";
}

function login(){
  var pass = document.getElementById("adminPass").value;
  if(pass === ADMIN_PASSWORD){
    localStorage.setItem("adminLogin","true");
    location.reload();
  }else{
    alert("Password salah!");
  }
}

function logout(){
  localStorage.removeItem("adminLogin");
  location.reload();
}

// ================= LOAD PRODUCTS =================
db.ref("products").on("value", function(snapshot){
  products = snapshot.val() || [];
  renderProducts();
});

// ================= LOAD ORDERS =================
db.ref("orders").on("value", function(snapshot){
  var html="";
  snapshot.forEach(function(child){
    var o = child.val();
    html += "<tr>"+
      "<td>"+(o.date||"-")+"</td>"+
      "<td>"+(o.name||"-")+"</td>"+
      "<td>"+(o.product||"-")+"</td>"+
      "<td>"+(o.qty||1)+"</td>"+
      "<td>Rp "+(o.total||0)+"</td>"+
      "</tr>";
  });
  document.getElementById("orders").innerHTML = html;
});

// ================= ADD PRODUCT =================
function addProduct(){
  var name = document.getElementById("pName").value;
  var price = Number(document.getElementById("pPrice").value);
  var stock = Number(document.getElementById("pStock").value);

  if(!name) return alert("Nama kosong!");

  products.push({name:name, price:price, stock:stock});
  db.ref("products").set(products);

  pName.value="";
  pPrice.value="";
  pStock.value="";
}

// ================= RENDER =================
function renderProducts(){
  var html="";
  products.forEach(function(p,i){
    html += "<div class='card'>"+
      "<b>"+p.name+"</b><br>"+
      "Harga: Rp "+p.price+"<br>"+
      "Stok: "+p.stock+"<br><br>"+
      "<button onclick='updateStock("+i+",1)'>+ Stok</button> "+
      "<button onclick='updateStock("+i+",-1)'>- Stok</button> "+
      "<button onclick='deleteProduct("+i+")' style='background:red'>Hapus</button>"+
      "</div>";
  });
  document.getElementById("products").innerHTML = html;
}

function updateStock(i,change){
  products[i].stock += change;
  if(products[i].stock < 0) products[i].stock = 0;
  db.ref("products").set(products);
}

function deleteProduct(i){
  if(confirm("Yakin hapus?")){
    products.splice(i,1);
    db.ref("products").set(products);
  }
}
// ================= RESET PRODUK =================
function resetProducts(){
  if(confirm("Yakin ingin hapus semua produk?")){
    db.ref("products").remove();
  }
}

// ================= RESET ORDERS =================
function resetOrders(){
  if(confirm("Yakin ingin hapus semua order?")){
    db.ref("orders").remove();
  }
}

// ================= RESET SEMUA =================
function resetAll(){
  if(confirm("Yakin ingin hapus SEMUA DATA?")){
    db.ref().remove();
  }
}
</script>

</body>
</html>
