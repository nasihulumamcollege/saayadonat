<script>
var firebaseConfig = {
  apiKey: "AIzaSyA7Ui4SXydisrIUpeX32vpqcIDQCsqOLXo",
  authDomain: "saayadonat.firebaseapp.com",
  databaseURL: "https://saayadonat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "saayadonat",
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var products = [];
var ADMIN_PASSWORD = "admin123"; // ganti password

// ==========================
// CEK STATUS LOGIN (PROTEKSI)
// ==========================
window.onload = function(){
  if(localStorage.getItem("adminLogin") === "true"){
    showAdmin();
  }else{
    showLogin();
  }
};

function showAdmin(){
  loginPage.classList.add("hidden");
  adminPanel.classList.remove("hidden");
}

function showLogin(){
  loginPage.classList.remove("hidden");
  adminPanel.classList.add("hidden");
}

// ==========================
// LOGIN
// ==========================
function login(){
  if(adminPass.value === ADMIN_PASSWORD){
    localStorage.setItem("adminLogin","true");
    showAdmin();
  }else{
    alert("Password salah!");
  }
}

// ==========================
// LOGOUT
// ==========================
function logout(){
  localStorage.removeItem("adminLogin");
  showLogin();
}

// ==========================
// LOAD PRODUK
// ==========================
db.ref("products").on("value", function(snapshot){
  products = snapshot.val() || [];
  renderProducts();
});

// ==========================
// LOAD ORDER
// ==========================
db.ref("orders").on("value", function(snapshot){
  var html="";
  snapshot.forEach(function(child){
    var o = child.val();
    html+=`
    <tr>
      <td>${o.date || "-"}</td>
      <td>${o.name || "-"}</td>
      <td>${o.product || "-"}</td>
      <td>${o.qty || 1}</td>
      <td>Rp ${o.total || 0}</td>
    </tr>`;
  });
  document.getElementById("orders").innerHTML = html;
});

// ==========================
// TAMBAH PRODUK
// ==========================
function addProduct(){
  products.push({
    name:pName.value,
    price:+pPrice.value,
    stock:+pStock.value
  });
  db.ref("products").set(products);
  pName.value="";
  pPrice.value="";
  pStock.value="";
}

// ==========================
// RENDER PRODUK
// ==========================
function renderProducts(){
  var html="";
  products.forEach(function(p,i){
    html+=`
      <div class="card">
      <b>${p.name}</b><br>
      Harga: Rp ${p.price}<br>
      Stok: ${p.stock}<br><br>

      <button onclick="updateStock(${i},1)">+ Stok</button>
      <button onclick="updateStock(${i},-1)">- Stok</button>
      <button onclick="deleteProduct(${i})" style="background:red">Hapus</button>
      </div>`;
  });
  document.getElementById("products").innerHTML = html;
}

// ==========================
// UPDATE STOK
// ==========================
function updateStock(index, change){
  products[index].stock += change;
  if(products[index].stock < 0){
    products[index].stock = 0;
  }
  db.ref("products").set(products);
}

// ==========================
// HAPUS PRODUK
// ==========================
function deleteProduct(index){
  if(confirm("Yakin hapus produk?")){
    products.splice(index,1);
    db.ref("products").set(products);
  }
}
</script>
