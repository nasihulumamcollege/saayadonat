<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SaAya Donat</title>

<style>
body{font-family:Arial;background:#fff0f6;margin:0;padding:15px}
.card{background:#fff;padding:15px;margin-bottom:15px;border-radius:12px}
button{padding:8px 12px;border:none;background:#ff6fb5;color:#fff;border-radius:8px}
.badge{background:#ffb3d9;padding:3px 8px;border-radius:20px;font-size:12px}
</style>
</head>
<body>

<h2>üç© SaAya Donat</h2>

<div id="products"></div>

<h3>Data Pemesan</h3>
<input id="name" placeholder="Nama"><br><br>
<button onclick="checkout()">Pesan</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyA7Ui4SXydisrIUpeX32vpqcIDQCsqOLXo",
  authDomain: "saayadonat.firebaseapp.com",
  databaseURL: "https://saayadonat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "saayadonat",
  storageBucket: "saayadonat.firebasestorage.app",
  messagingSenderId: "191838417140",
  appId: "1:191838417140:web:b698670357abe7dff2eea1"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var products = [];
var cartIndex = null;

db.ref("products").on("value", function(snapshot){
  products = snapshot.val() || [];
  render();
});

function render(){
  var html="";
  products.forEach(function(p,i){
    if(p.stock>0){
      html+=`
      <div class="card">
        <b>${p.name}</b><br>
        Rp ${p.price}<br>
        <span class="badge">Stok ${p.stock}</span><br><br>
        <button onclick="selectProduct(${i})">Pilih</button>
      </div>`;
    }
  });
  document.getElementById("products").innerHTML = html;
}

function selectProduct(i){
  cartIndex = i;
  alert("Produk dipilih");
}

function checkout(){
  if(cartIndex===null) return alert("Pilih produk dulu!");
  var nama = document.getElementById("name").value;
  if(nama==="") return alert("Isi nama dulu!");

  var p = products[cartIndex];
  if(p.stock<=0) return alert("Stok habis!");

  p.stock -= 1;

  db.ref("products").set(products);

  db.ref("orders").push({
    date:new Date().toLocaleDateString(),
    name:nama,
    product:p.name,
    qty:1,
    total:p.price
  });

  alert("Pesanan berhasil ‚ù§Ô∏è");
}
</script>

</body>
</html>    total+=p.price*c.qty;

    firebase.database().ref("orders").push({
      date:new Date().toLocaleDateString(),
      name:bName.value,
      product:p.name,
      qty:c.qty,
      total:p.price*c.qty
    });
  });

  firebase.database().ref("products").set(products);

  cart=[];
  alert("Pesanan berhasil ‚ù§Ô∏è");
}
</script>
    if(p.stock < c.qty){
      alert('Stok tidak cukup!');
      return;
    }

    p.stock -= c.qty;
    total += p.price*c.qty;

    push(ref(db,'orders'),{
      date:new Date().toLocaleDateString(),
      name:bName.value,
      product:p.name,
      qty:c.qty,
      total:p.price*c.qty
    });
  });

  set(ref(db,'products'), products);

  cart=[];
  alert('Pesanan berhasil ‚ù§Ô∏è');
}

</script>
</div>

<script>
let products=JSON.parse(localStorage.getItem('products')||'[]');
let cart=[];

function render(){
let html='';
products.forEach((p,i)=>{
if(p.stock>0){
html+=`
<div class="product">
<b>${p.name}</b><br>
Rp ${p.price}<br>
<span class="badge">Stok ${p.stock}</span><br>
<button onclick="addCart(${i})">Tambah</button>
</div>`;
}
});
document.getElementById('productList').innerHTML=html;
renderCart();
}

function addCart(i){
let existing=cart.find(c=>c.index===i);
if(existing){ existing.qty++; }
else{ cart.push({index:i,qty:1}); }
renderCart();
}

function removeCart(i){
cart.splice(i,1);
renderCart();
}

function renderCart(){
let html='';
let total=0;

cart.forEach((c,i)=>{
let p=products[c.index];
let subtotal=p.price*c.qty;
total+=subtotal;

html+=`
<div class="cart-item">
${p.name} (${c.qty}) - Rp ${subtotal}
<button onclick="removeCart(${i})">Hapus</button>
</div>`;
});

document.getElementById('cartList').innerHTML=html||'Keranjang kosong';
document.getElementById('totalPrice').innerText=total;
}

function toggleRekening(){
let metode=bMethod.value;
document.getElementById('rekeningBox').style.display=
metode==="Transfer"?"block":"none";
}

function checkout(){
if(cart.length===0)return alert('Keranjang kosong');

let name=bName.value;
let phone=bPhone.value;
let address=bAddress.value;
let method=bMethod.value;

if(!name || !phone || !address){
return alert('Lengkapi data terlebih dahulu');
}

let total=0;
let pesan=`Halo, saya ingin pesan:%0A%0A`;

cart.forEach(c=>{
let p=products[c.index];
let subtotal=p.price*c.qty;
total+=subtotal;
pesan+=`${p.name} (${c.qty}) - Rp ${subtotal}%0A`;
});

pesan+=`%0ATotal: Rp ${total}%0A`;
pesan+=`%0ANama: ${name}%0A`;
pesan+=`No WA: ${phone}%0A`;
pesan+=`Alamat: ${address}%0A`;
pesan+=`Metode: ${method}%0A`;

if(method==="Transfer"){
pesan+=`%0ASaya akan transfer ke rekening yang tertera dan kirim bukti pembayaran.`;
}

let noWA="6287789130676"; // GANTI NOMOR WA KAMU
window.open(`https://wa.me/${noWA}?text=${pesan}`,'_blank');

cart=[];
renderCart();
}

render();
</script>

</body>
</html>
